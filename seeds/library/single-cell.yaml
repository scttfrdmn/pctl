# Single-Cell RNA-Seq Cluster Template
# Use Case: Single-cell RNA-seq analysis (10x Genomics, Drop-seq, Smart-seq)
# Domain: Bioinformatics
# Optimized for: Large-scale single-cell analysis with high memory requirements
# Included software: Cell Ranger, Seurat (R), Scanpy (Python), velocyto
# Instance recommendations: High-memory (r5.12xlarge, r5.24xlarge) for large datasets
# Estimated costs: ~$3-4/hour for r5.12xlarge, ~$6-8/hour for r5.24xlarge

cluster:
  name: singlecell-cluster
  region: us-east-1

compute:
  # Medium head node for interactive analysis
  head_node: m5.2xlarge

  queues:
    # High-memory queue for Cell Ranger and large dataset processing
    # Cell Ranger requires ~8GB per 1000 cells
    # 100k cell dataset needs ~800GB RAM
    - name: highmem
      instance_types:
        - r5.12xlarge  # 48 vCPU, 384GB RAM - typical datasets
        - r5.16xlarge  # 64 vCPU, 512GB RAM - large datasets
        - r5.24xlarge  # 96 vCPU, 768GB RAM - very large datasets
        - x1e.8xlarge  # 32 vCPU, 976GB RAM - ultra-large datasets
      min_count: 0
      max_count: 10

    # Medium-memory queue for downstream analysis
    # Clustering, differential expression, visualization
    - name: analysis
      instance_types:
        - r5.4xlarge   # 16 vCPU, 128GB RAM
        - r5.8xlarge   # 32 vCPU, 256GB RAM
      min_count: 0
      max_count: 20

    # CPU-optimized queue for parallel batch processing
    # Multiple samples, integration workflows
    - name: batch
      instance_types:
        - c5.4xlarge   # 16 vCPU, 32GB RAM
        - c5.9xlarge   # 36 vCPU, 72GB RAM
        - c5.18xlarge  # 72 vCPU, 144GB RAM
      min_count: 0
      max_count: 15

software:
  spack_packages:
    # Compilers and build tools
    - gcc@11.3.0
    - cmake@3.26.0

    # Python ecosystem for Scanpy
    - python@3.10.8
    - py-pip@23.0
    - py-numpy@1.24.0
    - py-scipy@1.10.0
    - py-pandas@2.0.0
    - py-matplotlib@3.7.0
    - py-seaborn@0.12.0

    # Scientific Python packages
    - py-scikit-learn@1.2.0
    - py-statsmodels@0.13.5
    - py-networkx@3.0
    - py-h5py@3.8.0
    - py-numba@0.56.4  # Performance optimization

    # Jupyter for interactive analysis
    - py-jupyter@1.0.0
    - py-jupyterlab@3.6.0
    - py-ipython@8.12.0

    # R language and Bioconductor
    - r@4.2.2
    # Note: Seurat and Bioconductor packages installed via R
    # - Seurat (via R install.packages)
    # - SingleCellExperiment (via Bioconductor)
    # - scater, scran (via Bioconductor)

    # Cell Ranger
    # Note: Cell Ranger is proprietary software from 10x Genomics
    # Download from: https://support.10xgenomics.com/single-cell-gene-expression/software
    # Install manually or via custom script

    # Alignment and quantification tools
    - star@2.7.10b     # Used by Cell Ranger
    - salmon@1.9.0
    - kallisto@0.48.0

    # Quality control
    - fastqc@0.11.9
    - multiqc@1.13

    # File format support
    - hdf5@1.14.0
    - samtools@1.17
    - bedtools2@2.30.0

    # Utilities
    - git@2.40.0
    - git-lfs@3.3.0    # For large reference files
    - parallel@20230422
    - tmux@3.3a
    - htop@3.2.1
    - vim@9.0

    # Visualization
    - graphviz@8.0.0

users:
  - name: scrna1
    uid: 10001
    gid: 10001
  - name: scrna2
    uid: 10002
    gid: 10002
  - name: scrna3
    uid: 10003
    gid: 10003

data:
  s3_mounts:
    # Raw FASTQ files from sequencer
    - bucket: my-scrna-fastq
      mount_point: /shared/fastq

    # Reference genomes and transcriptomes
    - bucket: my-scrna-references
      mount_point: /shared/references

    # Cell Ranger outputs (feature-barcode matrices)
    - bucket: my-cellranger-outputs
      mount_point: /shared/cellranger

    # Processed Seurat/Scanpy objects
    - bucket: my-scrna-objects
      mount_point: /shared/objects

    # Analysis results and figures
    - bucket: my-scrna-results
      mount_point: /shared/results

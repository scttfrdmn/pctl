# JupyterHub Cluster Template
# Use Case: Multi-user Jupyter notebook environment for collaborative work
# Domain: General Purpose / Development
# Optimized for: Interactive computing, teaching, workshops, team collaboration
# Included software: JupyterHub, JupyterLab, Python, R, Julia, data science stack
# Instance recommendations: General purpose (m5) for balanced workloads
# Estimated costs: ~$0.75-1.50/hour for m5.4xlarge usage

cluster:
  name: jupyterhub-cluster
  region: us-east-1

compute:
  # Large head node to run JupyterHub server
  # JupyterHub proxy and hub need resources for multiple users
  head_node: m5.2xlarge

  queues:
    # General purpose queue for user notebook servers
    # Each user gets their own server on compute nodes
    - name: notebooks
      instance_types:
        - m5.2xlarge   # 8 vCPU, 32GB RAM - ~2-4 users
        - m5.4xlarge   # 16 vCPU, 64GB RAM - ~4-8 users
        - m5.8xlarge   # 32 vCPU, 128GB RAM - ~8-16 users
      min_count: 1     # Keep 1 node for active users
      max_count: 20    # Scale up for many users

    # Memory-optimized queue for data-intensive notebooks
    # Users working with large datasets
    - name: highmem-notebooks
      instance_types:
        - r5.2xlarge   # 8 vCPU, 64GB RAM
        - r5.4xlarge   # 16 vCPU, 128GB RAM
        - r5.8xlarge   # 32 vCPU, 256GB RAM
      min_count: 0
      max_count: 10

    # GPU queue for ML/DL notebooks
    # Users training models or running GPU workloads
    - name: gpu-notebooks
      instance_types:
        - g4dn.xlarge   # 1x T4 16GB, 4 vCPU, 16GB RAM
        - g4dn.2xlarge  # 1x T4 16GB, 8 vCPU, 32GB RAM
        - g5.xlarge     # 1x A10G 24GB, 4 vCPU, 16GB RAM
      min_count: 0
      max_count: 8

software:
  spack_packages:
    # Build tools
    - gcc@11.3.0
    - cmake@3.26.0

    # Node.js for JupyterHub configurable-http-proxy
    - node-js@18.16.0

    # Python ecosystem
    - python@3.10.8
    - py-pip@23.0

    # JupyterHub and JupyterLab
    - py-jupyterhub@4.0.0
    - py-jupyterlab@3.6.0
    - py-jupyter@1.0.0
    - py-ipython@8.12.0
    - py-notebook@6.5.3

    # Data science stack for Python
    - py-numpy@1.24.0
    - py-scipy@1.10.0
    - py-pandas@2.0.0
    - py-matplotlib@3.7.0
    - py-seaborn@0.12.0
    - py-plotly@5.14.0
    - py-scikit-learn@1.2.0
    - py-statsmodels@0.13.5

    # Machine learning (CPU versions)
    # Note: GPU versions best installed via pip/conda
    - py-torch@2.0.0
    - py-scikit-learn@1.2.0

    # Notebook extensions and widgets
    - py-ipywidgets@8.0.6
    - py-ipympl@0.9.3  # Interactive matplotlib
    # - jupyterlab-git (pip - git integration)
    # - jupyterlab-lsp (pip - language server)

    # R language and kernel
    - r@4.2.2
    # Note: R kernel (IRkernel) installed via R
    # install.packages("IRkernel")
    # IRkernel::installspec(user = FALSE)

    # Julia (optional - popular for scientific computing)
    # - julia@1.9.0
    # Note: Julia kernel installed via Julia
    # using Pkg; Pkg.add("IJulia")

    # Data formats and databases
    - py-h5py@3.8.0
    - py-pyarrow@11.0.0
    - py-sqlalchemy@2.0.7
    - py-psycopg2@2.9.5
    - hdf5@1.14.0
    - postgresql@15.2

    # Utilities
    - git@2.40.0
    - git-lfs@3.3.0
    - tmux@3.3a
    - htop@3.2.1
    - vim@9.0
    - parallel@20230422

    # GPU support (for GPU queue)
    - cuda@11.8.0
    - cudnn@8.6.0
    - nvtop@2.0.0

users:
  # Example users - add more as needed
  - name: instructor
    uid: 14001
    gid: 14001
  - name: student1
    uid: 14101
    gid: 14100
  - name: student2
    uid: 14102
    gid: 14100
  - name: student3
    uid: 14103
    gid: 14100
  - name: researcher1
    uid: 14201
    gid: 14200
  - name: researcher2
    uid: 14202
    gid: 14200

data:
  s3_mounts:
    # Shared notebooks and course materials
    - bucket: my-jupyter-shared
      mount_point: /shared/notebooks

    # Datasets for analysis
    - bucket: my-jupyter-datasets
      mount_point: /shared/datasets

    # User home directories (persistent storage)
    - bucket: my-jupyter-homes
      mount_point: /shared/homes

    # Completed assignments and projects
    - bucket: my-jupyter-projects
      mount_point: /shared/projects

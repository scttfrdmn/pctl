# Systems Biology Cluster Template
# Use Case: Network analysis, pathway modeling, metabolic flux analysis
# Domain: Computational Biology
# Optimized for: Graph analysis, constraint-based modeling, network inference
# Included software: COBRA Toolbox, Cytoscape, NetworkX, igraph, Systems Biology Toolbox
# Instance recommendations: Memory-optimized (r5) for large networks, compute (c5) for simulations
# Estimated costs: ~$1.50/hour for m5.4xlarge, ~$1/hour for c5.2xlarge

cluster:
  name: sysbio-cluster
  region: us-east-1

compute:
  # Medium head node for Cytoscape and interactive work
  head_node: m5.xlarge

  queues:
    # Network analysis queue for large-scale graphs
    # Protein-protein interactions, gene regulatory networks
    - name: network-analysis
      instance_types:
        - r5.2xlarge   # 8 vCPU, 64GB RAM
        - r5.4xlarge   # 16 vCPU, 128GB RAM
        - r5.8xlarge   # 32 vCPU, 256GB RAM
      min_count: 0
      max_count: 15

    # Simulation queue for dynamic modeling
    # ODE models, stochastic simulations, parameter estimation
    - name: simulation
      instance_types:
        - c5.2xlarge   # 8 vCPU, 16GB RAM
        - c5.4xlarge   # 16 vCPU, 32GB RAM
        - c5.9xlarge   # 36 vCPU, 72GB RAM
      min_count: 0
      max_count: 25

    # General purpose for metabolic modeling
    # COBRA analysis, flux balance analysis
    - name: metabolic
      instance_types:
        - m5.2xlarge   # 8 vCPU, 32GB RAM
        - m5.4xlarge   # 16 vCPU, 64GB RAM
        - m5.8xlarge   # 32 vCPU, 128GB RAM
      min_count: 0
      max_count: 20

    # Machine learning for network inference
    # Bayesian networks, random forests, deep learning
    - name: ml
      instance_types:
        - g4dn.xlarge   # 1x T4 16GB
        - g4dn.2xlarge  # 1x T4 16GB
        - c5.4xlarge    # CPU for non-DL methods
      min_count: 0
      max_count: 8

software:
  spack_packages:
    # Compilers
    - gcc@11.3.0

    # Python ecosystem
    - python@3.10.8
    - py-pip@23.0
    - py-numpy@1.24.0
    - py-scipy@1.10.0
    - py-pandas@2.0.0
    - py-matplotlib@3.7.0
    - py-seaborn@0.12.0

    # Network analysis
    - py-networkx@3.0
    # - igraph (pip - fast graph algorithms)
    # - graph-tool (conda - very fast, C++ backend)
    # - cdlib (pip - community detection)
    # - networkit (pip - large-scale networks)

    # Systems biology packages (install via pip)
    # - cobra (pip - COBRA Toolbox Python)
    # - tellurium (pip - systems biology modeling)
    # - pysb (pip - rule-based modeling)
    # - bioservices (pip - web services access)
    # - mygene (pip - gene annotation)

    # ODE and simulation
    # - roadrunner (pip - SBML simulator)
    # - gillespy2 (pip - stochastic simulation)
    # - assimulo (pip - ODE/DAE solver)

    # Statistical and ML libraries
    - py-scikit-learn@1.2.0
    - py-statsmodels@0.13.5
    - py-torch@2.0.0+cuda
    # - pomegranate (pip - probabilistic models)
    # - bnlearn (R package - Bayesian networks)

    # Optimization for flux analysis
    # - cplex (commercial - requires license)
    # - gurobi (commercial - requires license)
    # - glpk (open-source linear programming)

    # Cytoscape (desktop app)
    # Note: May require manual installation
    # - cytoscape (manual/conda)

    # R for bioinformatics
    - r@4.2.2
    # R packages (install via R):
    # - Bioconductor packages (BiocManager::install)
    # - graph, RBGL (graph algorithms)
    # - limma, edgeR (differential expression)

    # Visualization
    - py-plotly@5.14.0
    - graphviz@8.0.1
    - py-pygraphviz@1.10
    # - circos (manual - circular visualizations)

    # Jupyter for interactive analysis
    - py-jupyter@1.0.0
    - py-jupyterlab@3.6.0

    # Database support
    - postgresql@15.2
    - py-sqlalchemy@2.0.7
    - py-psycopg2@2.9.5

    # File formats
    - hdf5@1.14.0
    - py-h5py@3.8.0
    # - libsbml (SBML support)

    # GPU support for ML
    - cuda@11.8.0
    - cudnn@8.6.0
    - nvtop@2.0.0

    # Utilities
    - git@2.40.0
    - parallel@20230422
    - tmux@3.3a
    - htop@3.2.1
    - vim@9.0

users:
  - name: sysbio1
    uid: 13001
    gid: 13001
  - name: sysbio2
    uid: 13002
    gid: 13002
  - name: sysbio3
    uid: 13003
    gid: 13003

data:
  s3_mounts:
    # Network data (interaction networks, pathways)
    - bucket: my-sysbio-networks
      mount_point: /shared/networks

    # Omics data (expression, metabolomics)
    - bucket: my-sysbio-omics
      mount_point: /shared/omics

    # Models (SBML, CellML, BioPAX)
    - bucket: my-sysbio-models
      mount_point: /shared/models

    # Simulation results and time series
    - bucket: my-sysbio-results
      mount_point: /shared/results

    # Reference databases (KEGG, Reactome, STRING)
    - bucket: my-sysbio-reference
      mount_point: /shared/reference
